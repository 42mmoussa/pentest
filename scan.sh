set -e

if [ "$#" -ne 1 ]; then
 echo "usage: ./scan.sh <ip>"
 exit -1
fi

if [ "$1" = "-h" ]; then
	echo "usage: ./scan.sh <ip>"
	echo "scan will be saved in <ip>.txt"
	exit 0
fi

FILE=$1.txt

printf "\n\n=========================SCAN=======================\n" > ${FILE}
echo "scanning on ip: $1"
nmap -T4 -p- $1 >> ${FILE}
echo "result saved in: ${FILE}"

PORTS="$(grep '^[0-9]' ${FILE} | cut -d/ -f 1 | tr '\n' ','  | rev | cut -c 2- | rev)"

if [ -z "${PORTS}" ]; then
        echo "scan: we've found 0 ports opened"
        exit 0
fi

echo "deep scanning on ip: $1"
printf "\n\n=======================DEEP SCAN====================\n" >> ${FILE}
nmap -T4 -p${PORTS} -A $1 >> ${FILE}
echo "result saved in: ${FILE}"
printf "\n\n=====================STRENGTH SCAN==================\n" >> ${FILE}
echo "strength scan on: $1"
nmap -T4 -p${PORTS} --script=ssl-enum-ciphers.nse $1 >> ${FILE}
echo "result saved in: ${FILE}"

