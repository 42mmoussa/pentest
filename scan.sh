set -e

if [ "$#" -ne 1 ]; then
 echo "Le nombre d'arguments est invalide"
 exit -1
fi

ping -c1 $1 > /dev/null
printf "\n\n=========================SCAN=======================\n" > $1.scan
echo "scanning on ip: $1"
nmap -T4 -p- $1 >> $1.scan
echo "result saved in: $1.scan"
PORTS="$(grep '^[0-9]' $1.scan | cut -d/ -f 1 | tr '\n' ','  | rev | cut -c 2- | rev)"
echo "deep scanning on ip: $1"
printf "\n\n=======================DEEP SCAN====================\n" >> $1.scan
nmap -T4 -p${PORTS} -A $1 >> $1.scan
echo "result saved in: $1.scan"
printf "\n\n=====================STRENGTH SCAN==================\n" >> $1.scan
echo "strength scan on: $1"
nmap -T4 --script=ssl-enum-ciphers.nse $1 >> $1.scan
echo "result saved in: $1.scan"
